<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>حاسبة عمولة مشروع زين</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
    
    body {
      font-family: 'Tajawal', sans-serif;
      background-color: #000000;
      color: #ffffff;
    }
    
    .card-bg {
      background-color: #1a1a1a;
      border-color: #333333;
    }
    
    .input-bg {
      background-color: #2d2d2d;
      color: #ffffff;
    }
    
    .progress-bar {
      transition: width 0.5s ease;
    }
    
    .tier-box {
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      background-color: #2d2d2d;
      border: 1px solid #444444;
    }
    
    .tier-active {
      border-right: 4px solid #3b82f6;
      background-color: #1e3a8a;
    }
    
    input {
      background-color: #333333;
      color: white;
      border-color: #555555;
    }
    
    .result-box {
      background-color: #1e1e1e;
      border-color: #3b82f6;
    }
    
    .bonus-box {
      background-color: #1a2e05;
      border-color: #4d7c0f;
    }
    
    .reminder-box {
      background-color: #422006;
      border-color: #f59e0b;
    }
    
    .next-tier-box {
      background-color: #1a1a3a;
      border-color: #6366f1;
      margin-top: 8px;
    }
  </style>
</head>
<body class="bg-black">
  <div id="root" class="min-h-screen py-8"></div>

  <script type="text/babel">
    function CommissionCalculator() {
      const [firstPeriod, setFirstPeriod] = React.useState("");
      const [secondPeriod, setSecondPeriod] = React.useState("");
      const [result, setResult] = React.useState(null);
      const currencyRate = 13;

      const firstTarget = 19250;
      const secondTarget = 15750;
      const totalTarget = firstTarget + secondTarget;

      const tiers = [
        { percent: 60, label: "الشريحة الأولى", rate: 2, minAmount: 11550 },
        { percent: 65, label: "الشريحة الثانية", rate: 2.5, minAmount: 12512.5 },
        { percent: 80, label: "الشريحة الثالثة", rate: 3, minAmount: 15400 },
        { percent: 90, label: "الشريحة الرابعة", rate: 4, minAmount: 17325 },
        { percent: 100, label: "الشريحة الخامسة", rate: 4.5, minAmount: 19250 }
      ];

      const calculateCommission = () => {
        const firstAmount = Number(firstPeriod) || 0;
        const secondAmount = Number(secondPeriod) || 0;
        const totalCollected = firstAmount + secondAmount;

        const getRate = (amount, target) => {
          const percent = (amount / target) * 100;
          for (let i = tiers.length - 1; i >= 0; i--) {
            if (percent >= tiers[i].percent) return tiers[i].rate;
          }
          return 0;
        };

        const getRemainingToNextTier = (amount, target) => {
          let nextTierIndex = -1;
          let nextTierAmount = 0;
          
          // البحث عن الشريحة التالية
          for (let i = 0; i < tiers.length; i++) {
            const tierAmount = (tiers[i].percent / 100) * target;
            if (amount < tierAmount) {
              nextTierIndex = i;
              nextTierAmount = tierAmount;
              break;
            }
          }
          
          // حساب المبلغ المتبقي لكل شريحة تالية
          const remainingToAllTiers = tiers.map(tier => {
            const tierAmount = (tier.percent / 100) * target;
            return {
              tier: tier.label,
              amountLeft: Math.max(0, tierAmount - amount),
              rate: tier.rate
            };
          }).filter(t => t.amountLeft > 0);

          return {
            progress: (amount / target) * 100,
            currentTierIndex: nextTierIndex > 0 ? nextTierIndex - 1 : -1,
            nextTierIndex,
            nextTierAmount,
            remainingToAllTiers
          };
        };

        const firstRate = getRate(firstAmount, firstTarget);
        const secondRate = getRate(secondAmount, secondTarget);

        const firstRemaining = getRemainingToNextTier(firstAmount, firstTarget);
        const secondRemaining = getRemainingToNextTier(secondAmount, secondTarget);

        const firstCommission = (firstRate / 100) * firstAmount;
        const secondCommission = (secondRate / 100) * secondAmount;
        const totalCommission = firstCommission + secondCommission;
        const bonus = (totalCollected >= totalTarget) ? 1 : 0;

        const commissionInEGP = totalCommission * currencyRate;

        setResult({
          firstRate,
          secondRate,
          firstCommission,
          secondCommission,
          totalCommission,
          bonus,
          commissionInEGP,
          firstRemaining,
          secondRemaining,
          totalCollected,
          totalTarget
        });
      };

      const resetCalculator = () => {
        setFirstPeriod("");
        setSecondPeriod("");
        setResult(null);
      };

      const renderTiersInfo = (remaining, target) => {
        return (
          <div className="mt-4 space-y-2">
            {remaining.remainingToAllTiers.length > 0 && (
              <div className="next-tier-box p-3 rounded-lg">
                <h4 className="font-bold text-blue-400 mb-2">المبالغ المتبقية للشرائح التالية:</h4>
                {remaining.remainingToAllTiers.map((tier, index) => (
                  <div key={index} className="flex justify-between items-center py-1">
                    <span className="text-sm">{tier.tier} ({tier.rate}%)</span>
                    <span className="font-bold">{tier.amountLeft.toLocaleString('ar-SA')} ريال</span>
                  </div>
                ))}
              </div>
            )}
            
            {tiers.map((tier, index) => (
              <div 
                key={index}
                className={`tier-box ${remaining.currentTierIndex === index ? 'tier-active' : ''}`}
              >
                <div className="flex justify-between items-center">
                  <span className="font-medium">{tier.label}</span>
                  <span className="text-blue-400 font-bold">{tier.rate}%</span>
                </div>
                <div className="text-sm text-gray-400 mt-1">
                  الحد الأدنى: {tier.minAmount.toLocaleString('ar-SA')} ريال
                </div>
              </div>
            ))}
          </div>
        );
      };

      return (
        <div className="max-w-3xl mx-auto mt-10 space-y-6 px-4">
          <div className="card-bg shadow-xl border rounded-xl">
            <div className="space-y-6 p-6">
              <h2 className="text-3xl font-bold text-center text-blue-400">📊 حاسبة العمولة لمشروع زين</h2>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* الفترة الأولى */}
                <div className="input-bg border rounded-lg p-4 shadow-md">
                  <h3 className="text-xl font-semibold mb-4 text-blue-400">الفترة الأولى (13/7 - 30/7)</h3>
                  <div className="flex items-center gap-2 mb-2">
                    <span className="text-sm text-gray-400">الهدف: {firstTarget.toLocaleString('ar-SA')} ريال</span>
                  </div>
                  <input
                    type="number"
                    value={firstPeriod}
                    onChange={(e) => setFirstPeriod(e.target.value)}
                    placeholder="أدخل المبلغ المحصل"
                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  />
                  
                  {result && (
                    <div className="mt-4 space-y-3">
                      <div className="flex justify-between text-sm text-gray-400 mb-1">
                        <span>0%</span>
                        <span>100%</span>
                      </div>
                      <div className="progress-bar bg-gray-700 rounded-full h-3">
                        <div 
                          className="progress-fill bg-blue-500 h-full rounded-full" 
                          style={{ width: `${result.firstRemaining.progress}%` }}
                        ></div>
                      </div>
                      
                      <div className="result-box p-3 rounded-lg border">
                        <p className="font-medium">الشريحة الحالية: <span className="text-blue-400">
                          {result.firstRemaining.currentTierIndex >= 0 ? 
                            tiers[result.firstRemaining.currentTierIndex].label : 
                            "أقل من الشريحة الأولى"}
                        </span></p>
                        <p className="font-medium">النسبة المطبقة: <span className="text-green-400">{result.firstRate}%</span></p>
                        <p className="font-medium">العمولة: <span className="text-blue-400">{result.firstCommission.toLocaleString('ar-SA', {maximumFractionDigits: 2})} ريال</span></p>
                      </div>
                      
                      {renderTiersInfo(result.firstRemaining, firstTarget)}
                    </div>
                  )}
                </div>

                {/* الفترة الثانية */}
                <div className="input-bg border rounded-lg p-4 shadow-md">
                  <h3 className="text-xl font-semibold mb-4 text-blue-400">الفترة الثانية (1/8 - 12/8)</h3>
                  <div className="flex items-center gap-2 mb-2">
                    <span className="text-sm text-gray-400">الهدف: {secondTarget.toLocaleString('ar-SA')} ريال</span>
                  </div>
                  <input
                    type="number"
                    value={secondPeriod}
                    onChange={(e) => setSecondPeriod(e.target.value)}
                    placeholder="أدخل المبلغ المحصل"
                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  />
                  
                  {result && (
                    <div className="mt-4 space-y-3">
                      <div className="flex justify-between text-sm text-gray-400 mb-1">
                        <span>0%</span>
                        <span>100%</span>
                      </div>
                      <div className="progress-bar bg-gray-700 rounded-full h-3">
                        <div 
                          className="progress-fill bg-blue-500 h-full rounded-full" 
                          style={{ width: `${result.secondRemaining.progress}%` }}
                        ></div>
                      </div>
                      
                      <div className="result-box p-3 rounded-lg border">
                        <p className="font-medium">الشريحة الحالية: <span className="text-blue-400">
                          {result.secondRemaining.currentTierIndex >= 0 ? 
                            tiers[result.secondRemaining.currentTierIndex].label : 
                            "أقل من الشريحة الأولى"}
                        </span></p>
                        <p className="font-medium">النسبة المطبقة: <span className="text-green-400">{result.secondRate}%</span></p>
                        <p className="font-medium">العمولة: <span className="text-blue-400">{result.secondCommission.toLocaleString('ar-SA', {maximumFractionDigits: 2})} ريال</span></p>
                      </div>
                      
                      {renderTiersInfo(result.secondRemaining, secondTarget)}
                    </div>
                  )}
                </div>
              </div>

              <div className="flex justify-center gap-4 mt-6">
                <button 
                  onClick={calculateCommission} 
                  className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-bold shadow-md transition duration-200"
                  disabled={!firstPeriod && !secondPeriod}
                >
                  احسب العمولة
                </button>
                <button 
                  onClick={resetCalculator} 
                  className="text-white border-2 border-blue-600 hover:bg-blue-900 px-8 py-3 rounded-lg font-bold shadow-md transition duration-200"
                >
                  إعادة تعيين
                </button>
              </div>

              {result && (
                <div className="result-box border rounded-xl p-6 mt-6 space-y-4">
                  <h4 className="text-xl font-semibold text-blue-400 text-center border-b border-gray-700 pb-3">📦 النتائج الإجمالية</h4>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-gray-800 p-4 rounded-lg border border-gray-700">
                      <p className="font-medium text-gray-400">إجمالي المحصل:</p>
                      <p className="text-xl font-bold text-white">
                        {result.totalCollected.toLocaleString('ar-SA')} / {result.totalTarget.toLocaleString('ar-SA')} ريال
                      </p>
                      <div className="progress-bar bg-gray-700 rounded-full h-2 mt-2">
                        <div 
                          className="progress-fill bg-green-500 h-full rounded-full" 
                          style={{ width: `${(result.totalCollected / result.totalTarget) * 100}%` }}
                        ></div>
                      </div>
                    </div>
                    <div className="bg-gray-800 p-4 rounded-lg border border-gray-700">
                      <p className="font-medium text-gray-400">إجمالي العمولة:</p>
                      <p className="text-xl font-bold text-white">
                        {result.totalCommission.toLocaleString('ar-SA', {maximumFractionDigits: 2})} ريال
                      </p>
                    </div>
                  </div>
                  
                  <div className="bg-gray-800 p-4 rounded-lg border border-gray-700">
                    <p className="font-medium text-gray-400">بالعملة المصرية:</p>
                    <p className="text-xl font-bold text-white">
                      {result.commissionInEGP.toLocaleString('ar-SA', {maximumFractionDigits: 2})} جنيه
                    </p>
                    <p className="text-sm text-gray-500 mt-1">(سعر الصرف ثابت: {currencyRate} جنيه/ريال)</p>
                  </div>
                  
                  {result.bonus ? (
                    <div className="bonus-box border-2 p-4 rounded-lg text-center mt-4 animate-pulse">
                      <p className="text-green-400 font-bold text-xl">🎉 مبروك! تستحق مكافأة راتب شهر 🎉</p>
                      <p className="text-green-300 mt-2">لقد حققت الهدف المطلوب ({result.totalTarget.toLocaleString('ar-SA')} ريال)</p>
                    </div>
                  ) : (
                    <div className="reminder-box border-2 p-4 rounded-lg text-center mt-4">
                      <p className="text-yellow-400 font-semibold text-lg">🔔 شد حيلك وهتوصل للمكافأة قريب 💪</p>
                      <p className="text-yellow-300 mt-2">
                        فاضل لك {(result.totalTarget - result.totalCollected).toLocaleString('ar-SA')} ريال لتحقيق المكافأة
                      </p>
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
          
          <div className="text-center text-sm text-gray-500 mt-6">
            <p>© 2024 حاسبة عمولة مشروع زين - آخر تحديث: 22 يوليو 2024</p>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<CommissionCalculator />);
  </script>
</body>
</html>